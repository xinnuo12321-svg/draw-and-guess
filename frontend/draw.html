<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä½ ç”»æˆ‘çŒœ - ç»ˆæå‘ç‰Œå™¨</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; background-color: #ffde59; display: flex; flex-direction: column; align-items: center; padding: 40px 0; margin: 0; min-height: 100vh; }
        .back-home { position: absolute; top: 20px; left: 20px; color: #333; text-decoration: none; font-weight: bold; background: white; padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .card { background: white; width: 320px; height: 380px; border-radius: 20px; box-shadow: 0 15px 30px rgba(0,0,0,0.2); display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; padding: 20px; text-align: center; z-index: 10; }
        .category { position: absolute; top: 20px; background: #ff5757; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .word { font-size: 44px; font-weight: 900; color: #333; margin: 20px 0; letter-spacing: 2px; }
        .hint { font-size: 16px; color: #666; margin-bottom: 20px; }
        .timer { font-size: 36px; font-weight: bold; color: #1a73e8; font-family: monospace; }
        
        /* æ“ä½œæŒ‰é’®ç»„ */
        .action-group { margin-top: 20px; display: flex; gap: 15px; display: none; /* åˆå§‹éšè—ï¼ŒæŠ½ç‰Œåæ˜¾ç¤º */ }
        .btn-correct { background: #00c853; color: white; border: none; padding: 12px 25px; font-size: 18px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .btn-wrong { background: #ff3d00; color: white; border: none; padding: 12px 25px; font-size: 18px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        
        .btn-draw { margin-top: 30px; background: #1a73e8; color: white; border: none; padding: 15px 40px; font-size: 20px; font-weight: bold; border-radius: 30px; cursor: pointer; box-shadow: 0 5px 15px rgba(26,115,232,0.4); }
        .btn-draw:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }

        /* å†å²è®°å½•æ¿ */
        .history-board { margin-top: 40px; background: white; width: 320px; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .history-board h3 { margin-top: 0; text-align: center; color: #333; }
        .history-list { list-style: none; padding: 0; margin: 0; max-height: 250px; overflow-y: auto; }
        .history-list li { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 16px; }
        .status-yes { color: #00c853; font-weight: bold; }
        .status-no { color: #ff3d00; font-weight: bold; }
    </style>
</head>
<body>
    <a href="/" class="back-home">â¬… è¿”å›å¤§å…</a>
    
    <div class="card">
        <div class="category" id="ui-category">å‡†å¤‡æ¸¸æˆ</div>
        <div class="word" id="ui-word">???</div>
        <div class="hint" id="ui-hint">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æŠ½ç‰Œ</div>
        <div class="timer" id="ui-timer">60s</div>
    </div>

    <div class="action-group" id="action-group">
        <button class="btn-wrong" onclick="recordResult(false)">âŒ æ²¡çŒœå‡º</button>
        <button class="btn-correct" onclick="recordResult(true)">âœ… çŒœå¯¹äº†</button>
    </div>

    <button class="btn-draw" id="draw-btn" onclick="fetchNewCard()">å¼€å§‹æŠ½ç‰Œ</button>

    <div class="history-board">
        <h3>ğŸ“ æ¸¸æˆè®°å½• (å…± <span id="total-count">0</span> å±€)</h3>
        <ul class="history-list" id="history-list">
            </ul>
    </div>

    <script>
        let countdownInterval;
        let currentWord = ""; // è®°å½•å½“å‰å¡ç‰Œä¸Šçš„è¯è¯­
        let roundCount = 0;   // è®°å½•ç©äº†ç¬¬å‡ å±€

        async function fetchNewCard() {
            const btn = document.getElementById('draw-btn');
            const wordEl = document.getElementById('ui-word');
            const categoryEl = document.getElementById('ui-category');
            const hintEl = document.getElementById('ui-hint');
            const timerEl = document.getElementById('ui-timer');
            const actionGroup = document.getElementById('action-group');

            // æŠ½ç‰Œæ—¶éšè—æ‰“åˆ†æŒ‰é’®
            actionGroup.style.display = "none";
            btn.style.display = "block";
            btn.disabled = true; 
            btn.innerText = "å‘ç‰Œå®˜æ­£åœ¨æ´—ç‰Œ...";
            wordEl.innerText = "ğŸ‘€"; 
            categoryEl.innerText = "è¯·æ±‚ä¸­"; 
            hintEl.innerText = "æ­£åœ¨ä» AI è¯åº“ä¸­æŠ½å–...";
            clearInterval(countdownInterval); 
            timerEl.innerText = "60s";

            try {
                const response = await fetch('/api/draw_card');
                const result = await response.json();
                if(result.status === "success") {
                    currentWord = result.data.word; // è®°ä¸‹å½“å‰çš„è¯è¯­
                    wordEl.innerText = currentWord; 
                    categoryEl.innerText = result.data.category; 
                    hintEl.innerText = result.data.hint;
                    startTimer(60, timerEl);
                    
                    // ç‰Œå‘å‡ºæ¥äº†ï¼Œéšè—æŠ½ç‰ŒæŒ‰é’®ï¼Œæ˜¾ç¤ºæ‰“åˆ†æŒ‰é’®
                    btn.style.display = "none";
                    actionGroup.style.display = "flex";
                }
            } catch (error) {
                wordEl.innerText = "ç½‘ç»œæ–­å¼€"; hintEl.innerText = "è¯·æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ";
            } finally {
                btn.disabled = false; btn.innerText = "ä¸‹ä¸€é¢˜";
            }
        }

        // è®°å½•æˆç»©å‡½æ•°
        function recordResult(isCorrect) {
            roundCount++;
            const listEl = document.getElementById('history-list');
            const countEl = document.getElementById('total-count');
            
            // åˆ›å»ºä¸€æ¡æ–°çš„è®°å½•è®°å½•
            const li = document.createElement('li');
            const statusHtml = isCorrect ? '<span class="status-yes">âœ… çŒœå¯¹</span>' : '<span class="status-no">âŒ æ²¡çŒœå‡º</span>';
            li.innerHTML = `<span>ç¬¬ ${roundCount} å±€: <b>${currentWord}</b></span> ${statusHtml}`;
            
            // æŠŠè®°å½•æ’åˆ°åˆ—è¡¨æœ€å‰é¢
            listEl.prepend(li);
            countEl.innerText = roundCount;

            // åœæ­¢å½“å‰å€’è®¡æ—¶
            clearInterval(countdownInterval);
            
            // éšè—æ‰“åˆ†æŒ‰é’®ï¼Œé‡æ–°æ˜¾ç¤ºæŠ½ç‰ŒæŒ‰é’®
            document.getElementById('action-group').style.display = "none";
            const btn = document.getElementById('draw-btn');
            btn.style.display = "block";
            btn.innerText = "æŠ½å–ä¸‹ä¸€é¢˜";
        }

        function startTimer(seconds, displayElement) {
            let timeLeft = seconds;
            displayElement.innerText = timeLeft + "s";
            countdownInterval = setInterval(() => {
                timeLeft--;
                displayElement.innerText = timeLeft + "s";
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    displayElement.innerText = "æ—¶é—´åˆ°!"; displayElement.style.color = "#ff3d00";
                } else {
                    displayElement.style.color = "#1a73e8";
                }
            }, 1000);
        }
    </script>
</body>
</html>